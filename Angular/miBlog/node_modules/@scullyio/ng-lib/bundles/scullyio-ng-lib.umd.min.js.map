{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","../../../../libs/ng-lib/src/lib/config/scully-config.ts","../../../../libs/ng-lib/src/lib/utils/basePathOnly.ts","../../../../libs/ng-lib/src/lib/utils/fetchHttp.ts","../../../../libs/ng-lib/src/lib/utils/isScully.ts","../../../../libs/ng-lib/src/lib/utils/merge-paths.ts","../../../../libs/ng-lib/src/lib/transfer-state/transfer-state.service.ts","../../../../libs/ng-lib/src/lib/idleMonitor/idle-monitor.service.ts","../../../../libs/ng-lib/src/lib/route-service/scully-routes.service.ts","../../../../libs/ng-lib/src/lib/scully-content/scully-content.component.ts","../../../../libs/ng-lib/src/lib/utils/findComments.ts","../../../../libs/ng-lib/src/lib/scully-content/scully-content.module.ts","../../../../libs/ng-lib/src/lib/scully-lib.module.ts"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","Object","create","__read","o","m","r","i","ar","error","ScullyDefaultSettings","useTransferState","alwaysMonitor","manualIdle","baseURIForScullyContent","SCULLY_LIB_CONFIG","InjectionToken","factory","basePathOnly","str","includes","split","endsWith","slice","fetchHttp","url","responseType","xhr","XMLHttpRequest","addEventListener","ev","status","response","err","_i","arguments","open","send","isScullyRunning","window","isScullyGenerated","mergePaths","base","path","startsWith","substr","SCULLY_SCRIPT_ID","SCULLY_STATE_START","SCULLY_STATE_END","TransferStateService","document","router","_this","inlineOnly","currentBaseUrl","stateBS","BehaviorSubject","state$","pipe","filter","state","undefined","nextUrl","events","NavigationStart","switchMap","initialUrl","NEVER","of","tap","NavigationEnd","first","map","urlAfterRedirects","shareReplay","prototype","startMonitoring","inlineStateOnly","setupEnvForTransferState","setupStartNavMonitoring","injectScript","exposed","transferState","saveState","location","pathname","script","createElement","setAttribute","last","lastChild","previousSibling","nodeName","insertBefore","getState","name","fetchTransferState","pluck","stateHasKey","hasOwnProperty","stateKeyHasValue","setState","val","newState","assign","_a","text","escapedText","textContent","JSON","stringify","'","$","`","/","<",">","replace","s","subscribe","useScullyTransferState","originalState","part","trim","setTimeout","take","toPromise","currentUrl","baseUrl","takeWhile","readFromIndex","readFromJson","catchError","console","warn","complete","dropPreSlash","html","unescapedText","newStateStr","parse","_~q~","_~b~","_~o~","_~s~","_~l~","_~g~","string","Injectable","args","providedIn","Document","decorators","type","Inject","DOCUMENT","Router","IdleMonitorService","zone","conf","tss","dropEndingSlash","imState","idle","timeOut","idle$","initApp","Event","bubbles","cancelable","appReady","appTimeout","scullyLibConfig","dispatchEvent","zoneIdleCheck","fireManualMyAppReadyEvent","init","Zone","taskTrackingZone","current","get","simpleTimeout","runOutsideAngular","tCancel","count","startTime","Date","now","monitor","clearTimeout","macroTasks","find","z","source","run","setPupeteerTimeoutValue","milliseconds","key","NgZone","ScullyRoutesService","refresh","ReplaySubject","allRoutes$","routes","Array","isArray","cleanDups","refCount","bufferSize","available$","list","published","unPublished$","topLevel$","route","reload","getCurrent","merge","curLocation","encodeURI","slugs","slug","Map","forEach","set","hasOtherprops","concat","__spread","values","obj","keys","lastHandled","ScullyContentComponent","elmRef","srs","elm","routeUpdates$","replaceContent","routeSub","ngOnInit","handlePage","curPage","href","template","currentCssId","getCSSId","scullyContent","htmlString","cssId","innerHTML","join","catch","isDevMode","uri","URL","atr","parent","parentElement","begin","createComment","end","content","querySelectorAll","upgradeToRoutelink","bind","tagName","hash","dataset","onclick","preventDefault","destination","getElementById","history","replaceState","toString","scrollIntoView","getAttribute","lnk","toLowerCase","splitRoute","curSplit","navigate","every","cur","rootElem","searchText","curNode","comments","createNodeIterator","NodeFilter","SHOW_COMMENT","acceptNode","node","nodeValue","FILTER_REJECT","FILTER_ACCEPT","nextNode","findComments","nextSibling","removeChild","getAttributeNames","a","ngOnDestroy","unsubscribe","Component","selector","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","preserveWhitespaces","ElementRef","Location","NgModule","declarations","exports","ScullyLibModule","forRoot","config","ngModule","providers","provide","useValue","imports","ScullyContentModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { InjectionToken } from '@angular/core';\n\nexport interface ScullyLibConfig {\n  useTransferState?: boolean;\n  alwaysMonitor?: boolean;\n  manualIdle?: boolean;\n  baseURIForScullyContent?: string;\n}\n\nexport const ScullyDefaultSettings: Required<ScullyLibConfig> = {\n  useTransferState: true,\n  alwaysMonitor: false,\n  manualIdle: false,\n  baseURIForScullyContent: 'http://localhost:1668',\n};\n\nexport const SCULLY_LIB_CONFIG = new InjectionToken<ScullyLibConfig>('scullyLibConfig', {\n  factory: () => ScullyDefaultSettings,\n});\n","/**\n * Take a string, preferably resembling an URL, take out the search params, the anchors, and the ending slash\n * @param str\n */\nexport const basePathOnly = (str: string): string => {\n  if (str.includes('#')) {\n    str = str.split('#')[0];\n  }\n  if (str.includes('?')) {\n    str = str.split('?')[0];\n  }\n  const cleanedUpVersion = str.endsWith('/') ? str.slice(0, -1) : str;\n  return cleanedUpVersion;\n};\n","export function fetchHttp<T>(\n  url: string,\n  responseType: XMLHttpRequestResponseType = 'json'\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    xhr.responseType = responseType;\n    xhr.addEventListener('load', ev => {\n      if (xhr.status !== 200) {\n        return reject(xhr);\n      }\n      resolve(xhr.response);\n    });\n    xhr.addEventListener('error', (...err) => reject(err));\n    xhr.open('get', url, true);\n    xhr.send();\n  });\n}\n","// tslint:disable: no-string-literal\nexport const isScullyRunning = () => window && window['ScullyIO'] === 'running';\nexport const isScullyGenerated = () =>\n  window && window['ScullyIO'] === 'generated';\n","export function mergePaths(base: string, path: string): string {\n  if (base.endsWith('/') && path.startsWith('/')) {\n    return `${base}${path.substr(1)}`;\n  }\n  if (!base.endsWith('/') && !path.startsWith('/')) {\n    return `${base}/${path}`;\n  }\n  return `${base}${path}`;\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { NavigationEnd, NavigationStart, Router } from '@angular/router';\nimport { BehaviorSubject, NEVER, Observable, of } from 'rxjs';\nimport { catchError, filter, first, map, pluck, shareReplay, switchMap, take, takeWhile, tap } from 'rxjs/operators';\nimport { basePathOnly } from '../utils/basePathOnly';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { isScullyGenerated, isScullyRunning } from '../utils/isScully';\nimport { mergePaths } from '../utils/merge-paths';\n\nconst SCULLY_SCRIPT_ID = `ScullyIO-transfer-state`;\nconst SCULLY_STATE_START = `/** ___SCULLY_STATE_START___ */`;\nconst SCULLY_STATE_END = `/** ___SCULLY_STATE_END___ */`;\nconst initialStateDone = '__done__with__Initial__navigation__';\n\ndeclare global {\n  interface Window {\n    'ScullyIO-injected': {\n      inlineStateOnly?: boolean;\n      [key: string]: any;\n    };\n  }\n}\n\ninterface State {\n  [key: string]: any;\n}\n// Adding this dynamic comment to suppress ngc error around Document as a DI token.\n// https://github.com/angular/angular/issues/20351#issuecomment-344009887\n/** @dynamic */\n@Injectable({\n  providedIn: 'root',\n})\nexport class TransferStateService {\n  private script: HTMLScriptElement;\n  /** parse from index, or load from data.json, according to scullConfig setting */\n  private inlineOnly = false;\n\n  private initialUrl: string;\n  /** set the currentBase to something that it can never be */\n  private currentBaseUrl = '//';\n  /** subject to fire off incoming states */\n  private stateBS = new BehaviorSubject<State>({});\n  private state$ = this.stateBS.pipe(filter((state) => state !== undefined));\n  // emit the next url when routing is complete\n  private nextUrl = this.router.events.pipe(\n    filter((e) => e instanceof NavigationStart),\n    switchMap((e: NavigationStart) => {\n      if (basePathOnly(this.initialUrl) === basePathOnly(e.url)) {\n        /** don't kick off on initial load to prevent flicker */\n        this.initialUrl = initialStateDone;\n        return NEVER;\n      }\n      return of(e);\n    }),\n    /** reset the state, so new components will never get stale data */\n    tap(() => this.stateBS.next(undefined)),\n    /** prevent emitting before navigation to _this_ URL is done. */\n    switchMap((e: NavigationStart) =>\n      this.router.events.pipe(\n        filter((ev) => ev instanceof NavigationEnd && ev.url === e.url),\n        first()\n      )\n    ),\n    map((ev: NavigationEnd) => basePathOnly(ev.urlAfterRedirects || ev.url)),\n    shareReplay(1)\n  );\n\n  constructor(@Inject(DOCUMENT) private document: Document, private router: Router) {}\n\n  startMonitoring() {\n    if (window && window['ScullyIO-injected'] && window['ScullyIO-injected'].inlineStateOnly) {\n      this.inlineOnly = true;\n    }\n    this.setupEnvForTransferState();\n    this.setupStartNavMonitoring();\n  }\n\n  private setupEnvForTransferState(): void {\n    if (isScullyRunning()) {\n      this.injectScript();\n      // In Scully puppeteer\n      const exposed = window['ScullyIO-exposed'] || {};\n      if (exposed.transferState) {\n        this.stateBS.next(exposed.transferState);\n        this.saveState(exposed.transferState);\n      }\n    } else if (isScullyGenerated()) {\n      // On the client AFTER scully rendered it\n      this.initialUrl = window.location.pathname || '__no_NO_no__';\n      this.initialUrl = this.initialUrl !== '/' && this.initialUrl.endsWith('/') ? this.initialUrl.slice(0, -1) : this.initialUrl;\n      /** set the initial state */\n      this.stateBS.next((window && window[SCULLY_SCRIPT_ID]) || {});\n    }\n  }\n\n  private injectScript() {\n    this.script = this.document.createElement('script');\n    this.script.setAttribute('id', SCULLY_SCRIPT_ID);\n    let last = document.body.lastChild;\n    while (last.previousSibling.nodeName === 'SCRIPT') {\n      last = last.previousSibling as ChildNode;\n    }\n    document.body.insertBefore(this.script, last);\n  }\n\n  /**\n   * Getstate will return an observable that containes the data.\n   * It does so right after the navigation for the page has finished.\n   * please note, this works SYNC on initial route, preventing a flash of content.\n   * @param name The name of the state to\n   */\n  getState<T>(name: string): Observable<T> {\n    /** start of the fetch for the current active route. */\n    this.fetchTransferState();\n    return this.state$.pipe(\n      pluck(name)\n      // tap((data) => console.log('tss', data))\n    );\n  }\n\n  /**\n   * Read the current state, and see if it has an value for the name.\n   * (note the value it containes still can be undefined!)\n   */\n  stateHasKey(name: string) {\n    return this.stateBS.value && this.stateBS.value.hasOwnProperty(name);\n  }\n\n  /**\n   * Read the current state, and see if it has an value for the name.\n   * ys also if there is actually an value in the state.\n   */\n  stateKeyHasValue(name: string) {\n    return this.stateBS.value && this.stateBS.value.hasOwnProperty(name) && this.stateBS.value[name] != null;\n  }\n\n  /**\n   * SetState will update the script in the generated page with data added.\n   * @param name\n   * @param val\n   */\n  setState<T>(name: string, val: T): void {\n    const newState = { ...this.stateBS.value, [name]: val };\n    this.stateBS.next(newState);\n    this.saveState(newState);\n  }\n\n  private saveState(newState) {\n    if (isScullyRunning()) {\n      this.script.textContent = `{window['${SCULLY_SCRIPT_ID}']=_u(\\`${SCULLY_STATE_START}${escapeHtml(\n        JSON.stringify(newState)\n      )}${SCULLY_STATE_END}\\`);function _u(t){t=t.split('${SCULLY_STATE_START}')[1].split('${SCULLY_STATE_END}')[0];const u={'_~b~': \"${'`'}\",'_~q~': \"'\",'_~o~': '$','_~s~': '/','_~l~': '<','_~g~': '>'};return JSON.parse(t.replace(/_~d~/g,'\\\\\\\\\"').replace(/_~[^]~/g, (s) => u[s]).replace(/\\\\n/g,'\\\\\\\\n').replace(/\\\\t/g,'\\\\\\\\t').replace(/\\\\r/g,'\\\\\\\\r'));}}`;\n    }\n  }\n\n  /**\n   * starts monitoring the router, and keep the url from the last completed navigation handy.\n   */\n  private setupStartNavMonitoring() {\n    if (!isScullyGenerated()) {\n      return;\n    }\n\n    /** start monitoring the routes */\n    this.nextUrl.subscribe();\n  }\n\n  /**\n   * Wraps an observable into scully's transfer state. If data for the provided `name` is\n   * available in the state, it gets returned. Otherwise, the `originalState` observable will\n   * be returned.\n   *\n   * On subsequent calls, the data in the state will always be returned. The `originalState` will\n   * be returned only once.\n   *\n   * This is a convenience method which does not require you to use `getState`/`setState` manually.\n   *\n   * @param name state key\n   * @param originalState an observable which yields the desired data\n   */\n  useScullyTransferState<T>(name: string, originalState: Observable<T>): Observable<T> {\n    if (isScullyGenerated()) {\n      return this.getState(name);\n    }\n    return originalState.pipe(tap((state) => this.setState(name, state)));\n  }\n\n  private async fetchTransferState(): Promise<void> {\n    /** helper to read the part before the first slash (ignores leading slash) */\n    const base = (url: string) => url.split('/').filter((part) => part.trim() !== '')[0];\n    /** put this in the next event cycle so the correct route can be read */\n    await new Promise((r) => setTimeout(r, 0));\n    /** get the current url */\n    const currentUrl = await this.nextUrl.pipe(take(1)).toPromise();\n    const baseUrl = base(currentUrl);\n    if (this.currentBaseUrl === baseUrl) {\n      /** already monitoring, don't tho a thing */\n      return;\n    }\n    /** keep the baseUrl for later reference */\n    this.currentBaseUrl = baseUrl;\n    this.nextUrl\n      .pipe(\n        /** keep updating till we move to another route */\n        takeWhile((url) => base(url) === this.currentBaseUrl),\n        // Get the next route's data from the the index or data file\n        switchMap((url) => (this.inlineOnly ? this.readFromIndex(url) : this.readFromJson(url))),\n        catchError((e) => {\n          // TODO: come up with better error text.\n          /** the developer needs to know, but its not fatal, so just return an empty state */\n          console.warn('Error while loading of parsing Scully state:', e);\n          return of({});\n        }),\n        tap((newState) => {\n          /** and activate the state in the components. on any error it will be empty */\n          this.stateBS.next(newState);\n        })\n      )\n      .subscribe({\n        /** when completes (different URL) */\n        complete: () => {\n          /** reset the currentBaseUrl */\n          this.currentBaseUrl = '//';\n        },\n      });\n  }\n\n  private readFromJson(url: string): Promise<object> {\n    return fetchHttp<object>(dropPreSlash(mergePaths(url, '/data.json')));\n  }\n\n  private readFromIndex(url): Promise<object> {\n    return fetchHttp<string>(dropPreSlash(mergePaths(url, '/index.html')), 'text').then((html: string) => {\n      const newStateStr = html.split(SCULLY_STATE_START)[1].split(SCULLY_STATE_END)[0];\n      return JSON.parse(unescapeHtml(newStateStr));\n    });\n  }\n}\n\nfunction dropPreSlash(string: string): string {\n  return string.startsWith('/') ? string.slice(1) : string;\n}\n\n/**\n * we need to escape our HTML to prevent XXS,\n * It needs to be custom, because the content can already contain html-escaped sequences\n **/\nexport function escapeHtml(text: string): string {\n  const escapedText: { [k: string]: string } = {\n    \"'\": '_~q~',\n    $: '_~o~',\n    '`': '_~b~',\n    '/': '_~s~',\n    '<': '_~l~',\n    '>': '_~g~',\n  };\n  return (\n    text\n      /** escape the json */\n      .replace(/[\\$`'<>\\/]/g, (s) => escapedText[s])\n      /** replace escaped double-quotes with single */\n      .replace(/\\\\\\\"/g, `_~d~`)\n  );\n}\n\n/**\n * Unescape our custom escaped texts\n * @param text\n */\nexport function unescapeHtml(text: string): string {\n  const unescapedText: { [k: string]: string } = {\n    '_~q~': \"'\",\n    '_~b~': '`',\n    '_~o~': '$',\n    '_~s~': '/',\n    '_~l~': '<',\n    '_~g~': '>',\n  };\n\n  return (\n    text\n      /** put back escaped double quotes to make valid json again */\n      .replace(/_~d~/g, `\\\\\"`)\n      /** replace the custom escapes */\n      .replace(/_~[^]~/g, (s) => unescapedText[s])\n      /** restore newlines+cr */\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n  );\n}\n","import { Inject, Injectable, NgZone } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { BehaviorSubject } from 'rxjs';\nimport { filter, pluck, take, tap } from 'rxjs/operators';\nimport { ScullyLibConfig, SCULLY_LIB_CONFIG, ScullyDefaultSettings } from '../config/scully-config';\nimport { TransferStateService } from '../transfer-state/transfer-state.service';\nimport { isScullyRunning } from '../utils/isScully';\n\n// tslint:disable-next-line: no-any\n// tslint:disable: no-string-literal\ndeclare const Zone: any;\n\ninterface LocalState {\n  idle: boolean;\n  timeOut: number;\n}\n\ndeclare global {\n  interface Window {\n    'ScullyIO-exposed': {\n      manualIdle?: boolean;\n      transferState?: any;\n      [key: string]: any;\n    };\n  }\n}\n\n// if (window) {\n//   window.addEventListener('AngularReady', ev => {\n//     console.log('appReady fired', ev);\n//   });\n// }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class IdleMonitorService {\n  private scullyLibConfig: ScullyLibConfig;\n  /** store the 'landing' url so we can skip it in idle-check. */\n  private initialUrl = dropEndingSlash(window && window.location && window.location.pathname) || '';\n  private imState = new BehaviorSubject<LocalState>({\n    idle: false,\n    timeOut: 5 * 1000, // 5 seconds timeout as default\n  });\n  public idle$ = this.imState.pipe(pluck('idle'));\n\n  private initApp = new Event('AngularInitialized', {\n    bubbles: true,\n    cancelable: false,\n  });\n  private appReady = new Event('AngularReady', {\n    bubbles: true,\n    cancelable: false,\n  });\n  private appTimeout = new Event('AngularTimeout', {\n    bubbles: true,\n    cancelable: false,\n  });\n\n  constructor(\n    private zone: NgZone,\n    private router: Router,\n    @Inject(SCULLY_LIB_CONFIG) conf: ScullyLibConfig,\n    tss: TransferStateService\n  ) {\n    /** provide the default for missing conf paramter */\n    this.scullyLibConfig = Object.assign({}, ScullyDefaultSettings, conf);\n    const exposed = window['ScullyIO-exposed'] || {};\n    const manualIdle = !!exposed.manualIdle;\n\n    if (!this.scullyLibConfig.manualIdle && window && (this.scullyLibConfig.alwaysMonitor || isScullyRunning())) {\n      window.dispatchEvent(this.initApp);\n      this.router.events\n        .pipe(\n          filter((ev) => ev instanceof NavigationEnd && ev.urlAfterRedirects !== undefined),\n          /** don't check the page that has this setting. event is only importand on page load */\n          filter((ev: NavigationEnd) => (manualIdle ? ev.urlAfterRedirects !== this.initialUrl : true)),\n          tap(() => this.zoneIdleCheck())\n        )\n        .subscribe();\n    }\n    if (this.scullyLibConfig.manualIdle) {\n      /** we still need the init event. */\n      window.dispatchEvent(this.initApp);\n    }\n    if (this.scullyLibConfig.useTransferState) {\n      /** don't start monitoring if people don't use the transferState */\n      tss.startMonitoring();\n    }\n  }\n\n  public async fireManualMyAppReadyEvent() {\n    return window.dispatchEvent(this.appReady);\n  }\n\n  public async init() {\n    return this.idle$.pipe(take(1)).toPromise();\n  }\n\n  private async zoneIdleCheck() {\n    if (Zone === undefined) {\n      return this.simpleTimeout();\n    }\n    const taskTrackingZone = Zone.current.get('TaskTrackingZone');\n    if (taskTrackingZone === undefined) {\n      return this.simpleTimeout();\n    }\n    if (this.imState.value.idle) {\n      await this.setState('idle', false);\n    }\n    /** run the actual check for 'idle' outsides zone, otherwise it will never come to an end. */\n    this.zone.runOutsideAngular(() => {\n      let tCancel: NodeJS.Timeout;\n      let count = 0;\n      const startTime = Date.now();\n      const monitor = () => {\n        clearTimeout(tCancel);\n        // console.table(taskTrackingZone.macroTasks);\n        if (Date.now() - startTime > 30 * 1000) {\n          /** bail out after 30 seconds. */\n          window.dispatchEvent(this.appTimeout);\n          return;\n        }\n        if (\n          (taskTrackingZone.macroTasks.length > 0 &&\n            taskTrackingZone.macroTasks.find((z: { source: string | string[] }) => z.source.includes('XMLHttpRequest')) !==\n              undefined) ||\n          count < 1 // make sure it runs at least once!\n        ) {\n          tCancel = setTimeout(() => {\n            count += 1;\n            monitor();\n          }, 50);\n          return;\n        }\n        this.zone.run(() => {\n          /** run this inside the zone, and give the app 250Ms to wrap up, before scraping starts */\n          setTimeout(() => {\n            window.dispatchEvent(this.appReady);\n            this.setState('idle', true);\n          }, 250);\n        });\n      };\n      monitor();\n    });\n  }\n\n  private async simpleTimeout() {\n    /** zone not available, use a timeout instead. */\n    console.warn('Scully is using timeouts, add the needed polyfills instead!');\n    await new Promise((r) => setTimeout(r, this.imState.value.timeOut));\n    window.dispatchEvent(this.appReady);\n  }\n\n  public setPupeteerTimeoutValue(milliseconds: number) {\n    this.imState.next({ ...this.imState.value, timeOut: milliseconds });\n  }\n\n  private setState(key: string, value: any) {\n    this.imState.next({ ...this.imState.value, [key]: value });\n  }\n}\n\nexport function dropEndingSlash(str: string) {\n  return str.endsWith('/') ? str.slice(0, -1) : str;\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, ReplaySubject, merge } from 'rxjs';\nimport {\n  catchError,\n  map,\n  shareReplay,\n  switchMap,\n  filter,\n} from 'rxjs/operators';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { Router, NavigationEnd, NavigationStart } from '@angular/router';\nimport { basePathOnly } from '../utils/basePathOnly';\n\nexport interface ScullyRoute {\n  route: string;\n  title?: string;\n  slugs?: string[];\n  published?: boolean;\n  slug?: string;\n  sourceFile?: string;\n  lang?: string;\n  [prop: string]: any;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ScullyRoutesService {\n  private refresh = new ReplaySubject<void>(1);\n  /**\n   * An observable with all routes, published and unpublished alike\n   */\n  allRoutes$: Observable<ScullyRoute[]> = this.refresh.pipe(\n    switchMap(() => fetchHttp<ScullyRoute[]>('assets/scully-routes.json')),\n    catchError(() => {\n      console.warn(\n        'Scully routes file not found, are you running the Scully generated version of your site?'\n      );\n      return of([] as ScullyRoute[]);\n    }),\n    /** filter out all non-array results */\n    filter((routes) => Array.isArray(routes)),\n    map(this.cleanDups),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n  /**\n   * An observable with available routes (all published routes)\n   */\n  available$ = this.allRoutes$.pipe(\n    map((list) =>\n      list.filter((r) =>\n        r.hasOwnProperty('published') ? r.published !== false : true\n      )\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  /**\n   * an observable with all unpublished routes\n   */\n  unPublished$ = this.allRoutes$.pipe(\n    map((list) =>\n      list.filter((r) =>\n        r.hasOwnProperty('published') ? r.published === false : false\n      )\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  /**\n   * An observable with the top-level off all published routes.\n   * (in an urls it would be `http://www.sample.org/__thisPart__/subroutes`)\n   */\n  topLevel$: Observable<ScullyRoute[]> = this.available$.pipe(\n    map((routes) =>\n      routes.filter((r: ScullyRoute) => !r.route.slice(1).includes('/'))\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  constructor(private router: Router) {\n    /** kick off first cycle */\n    this.reload();\n  }\n\n  /**\n   * returns an observable that returns the route information for the\n   * route currently selected. subscribes to route-events to update when needed\n   */\n  getCurrent(): Observable<ScullyRoute> {\n    if (!location) {\n      /** probably not in a browser, no current location available */\n      return of();\n    }\n    /** fire off at start, and when navigation is done. */\n    return merge(of(new NavigationEnd(0, '', '')), this.router.events).pipe(\n      filter((e) => e instanceof NavigationEnd),\n      switchMap(() => this.available$),\n      map((list) => {\n        const curLocation = basePathOnly(encodeURI(location.pathname).trim());\n        return list.find(\n          (r) =>\n            curLocation === basePathOnly(r.route.trim()) ||\n            (r.slugs &&\n              Array.isArray(r.slugs) &&\n              r.slugs.find((slug) =>\n                curLocation.endsWith(basePathOnly(slug.trim()))\n              ))\n        );\n      })\n    );\n  }\n\n  /**\n   * internal, as routes can have multiple slugs, and so occur multiple times\n   * this util function collapses all slugs back into 1 route.\n   */\n  private cleanDups(routes: ScullyRoute[]) {\n    const m = new Map<string, ScullyRoute>();\n    /** check for duplicates by comparing all, include route in comparison if its the only thing, or the only thing with only the tile  */\n    routes.forEach((r) =>\n      m.set(JSON.stringify({ ...r, route: hasOtherprops(r) ? '' : r.route }), r)\n    );\n    return [...m.values()];\n  }\n\n  /** an utility that will force a reload of the `scully-routes.json` file */\n  reload(): void {\n    this.refresh.next();\n  }\n}\n\nfunction hasOtherprops(obj) {\n  const keys = Object.keys(obj);\n  if (keys.length === 1 && keys.includes('route')) {\n    return false;\n  }\n  if (keys.length === 2 && keys.includes('route') && keys.includes('title')) {\n    return false;\n  }\n  return true;\n}\n","import { Location } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Inject,\n  isDevMode,\n  OnDestroy,\n  OnInit,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { filter, take, tap } from 'rxjs/operators';\nimport { ScullyDefaultSettings, ScullyLibConfig, SCULLY_LIB_CONFIG } from '../config/scully-config';\nimport { ScullyRoutesService } from '../route-service/scully-routes.service';\nimport { basePathOnly } from '../utils/basePathOnly';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { findComments } from '../utils/findComments';\n\ninterface ScullyContent {\n  html: string;\n  cssId: string;\n}\ndeclare global {\n  interface Window {\n    scullyContent: ScullyContent;\n  }\n}\n/** this is needed, because otherwise the CLI borks while building */\nconst scullyBegin = '<!--scullyContent-begin-->';\nconst scullyEnd = '<!--scullyContent-end-->';\n\n/** use the module's closure to keep a system-wide check for the last handled URL. */\nlet lastHandled: String;\n\n@Component({\n  // tslint:disable-next-line: component-selector\n  selector: 'scully-content',\n  template: '<ng-content></ng-content>',\n  styles: [\n    `\n      :host {\n        display: none;\n      }\n      scully-content {\n        display: none;\n      }\n    `,\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n  preserveWhitespaces: true,\n})\nexport class ScullyContentComponent implements OnDestroy, OnInit {\n  baseUrl = this.conf.useTransferState || ScullyDefaultSettings.useTransferState;\n  elm = this.elmRef.nativeElement as HTMLElement;\n  /** pull in all  available routes into an eager promise */\n  routes = this.srs.allRoutes$.pipe(take(1)).toPromise();\n  /** monitor the router, so we can update while navigating in the same 'page' see #311 */\n  routeUpdates$ = this.router.events.pipe(\n    filter((ev) => ev instanceof NavigationEnd),\n    /** don't replace if we are already there */\n    filter((ev: NavigationEnd) => lastHandled && !lastHandled.endsWith(ev.urlAfterRedirects)),\n    tap((r) => this.replaceContent())\n  );\n\n  routeSub = this.routeUpdates$.subscribe();\n\n  constructor(\n    private elmRef: ElementRef,\n    private srs: ScullyRoutesService,\n    private router: Router,\n    private location: Location,\n    @Inject(SCULLY_LIB_CONFIG) private conf: ScullyLibConfig\n  ) {\n    /** do this from constructor, so it runs ASAP */\n  }\n\n  ngOnInit(): void {\n    if (this.elm) {\n      /** this will only fire in a browser environment */\n      this.handlePage();\n    }\n  }\n\n  /**\n   * Loads the static content from scully into the view\n   * Will fetch the content from sibling links with xmlHTTPrequest\n   */\n  private async handlePage() {\n    const curPage = basePathOnly(location.href);\n    if (lastHandled === curPage) {\n      /**\n       * Due to the fix we needed for #311\n       * it might happen that this routine is called\n       * twice for the same page.\n       * this code will make sure the second one is ignored.\n       */\n      return;\n    }\n    lastHandled = curPage;\n    const template = document.createElement('template');\n    const currentCssId = this.getCSSId(this.elm);\n    if (window.scullyContent) {\n      /** upgrade existing static content */\n      const htmlString = window.scullyContent.html;\n      if (currentCssId !== window.scullyContent.cssId) {\n        /** replace the angular cssId */\n        template.innerHTML = htmlString.split(window.scullyContent.cssId).join(currentCssId);\n      } else {\n        template.innerHTML = htmlString;\n      }\n    } else {\n      /**\n       *   NOTE\n       * when updateting the texts for the errors, make sure you leave the\n       *  `id=\"___scully-parsing-error___\"`\n       * in there. That way users can detect rendering errors in their CI\n       * on a reliable way.\n       */\n      await fetchHttp(curPage + '/index.html', 'text')\n        .catch((e) => {\n          if (isDevMode()) {\n            /** in devmode (usually in `ng serve`) check the scully server for the content too */\n            const uri = new URL(location.href);\n            const url = `${this.conf.baseURIForScullyContent}/${basePathOnly(uri.pathname)}/index.html`;\n            return fetchHttp(url, 'text');\n          } else {\n            return Promise.reject(e);\n          }\n        })\n        .then((html: string) => {\n          try {\n            const htmlString = html.split(scullyBegin)[1].split(scullyEnd)[0];\n            if (htmlString.includes('_ngcontent')) {\n              /** update the angular cssId */\n              const atr = '_ngcontent' + htmlString.split('_ngcontent')[1].split('=')[0];\n              template.innerHTML = htmlString.split(atr).join(currentCssId);\n            } else {\n              template.innerHTML = htmlString;\n            }\n          } catch (e) {\n            template.innerHTML = `<h2 id=\"___scully-parsing-error___\">Sorry, could not parse static page content</h2>\n            <p>This might happen if you are not using the static generated pages.</p>`;\n          }\n        })\n        .catch((e) => {\n          template.innerHTML = '<h2 id=\"___scully-parsing-error___\">Sorry, could not load static page content</h2>';\n          console.error('problem during loading static scully content', e);\n        });\n    }\n    /** insert the whole thing just before the `<scully-content>` element */\n    const parent = this.elm.parentElement || document.body;\n    const begin = document.createComment('scullyContent-begin');\n    const end = document.createComment('scullyContent-end');\n    parent.insertBefore(begin, this.elm);\n    parent.insertBefore(template.content, this.elm);\n    parent.insertBefore(end, this.elm);\n    /** upgrade all hrefs to simulated routelinks (in next microtask) */\n    setTimeout(() => document.querySelectorAll('[href]').forEach(this.upgradeToRoutelink.bind(this)), 10);\n    // document.querySelectorAll('[href]').forEach(this.upgradeToRoutelink.bind(this));\n  }\n\n  /**\n   * upgrade a **href** attributes to links that respect the Angular router\n   * and don't do a full page reload. Only works on links that are found in the\n   * Scully route config file.\n   * @param elm the element containing the **hrefs**\n   */\n  async upgradeToRoutelink(elm: HTMLElement) {\n    if (!['A', 'BUTTON'].includes(elm.tagName)) {\n      return;\n    }\n    const hash = elm.dataset.hash;\n    if (hash) {\n      elm.setAttribute('href', '#' + hash);\n      elm.setAttribute('onclick', '');\n      elm.onclick = (ev: MouseEvent) => {\n        ev.preventDefault();\n        const destination = document.getElementById(hash);\n        if (destination) {\n          const url = new URL(window.location.href);\n          url.hash = hash;\n          history.replaceState('', '', url.toString());\n          destination.scrollIntoView();\n        }\n      };\n      return;\n    }\n    const routes = await this.routes;\n    const href = elm.getAttribute('href');\n    const lnk = basePathOnly(href.toLowerCase());\n    const route = routes.find((r) => basePathOnly(r.route.toLowerCase()) === lnk);\n\n    /** only upgrade routes known by scully. */\n    if (lnk && route && !lnk.startsWith('#')) {\n      elm.onclick = async (ev: MouseEvent) => {\n        const splitRoute = route.route.split(`/`);\n        const curSplit = location.pathname.split('/');\n        // loose last \"part\" of route\n        curSplit.pop();\n\n        ev.preventDefault();\n        const routed = await this.router.navigate(splitRoute).catch((e) => {\n          console.error('routing error', e);\n          return false;\n        });\n        if (!routed) {\n          return;\n        }\n\n        /** check for the same route with different \"data\", and NOT a 1 level higher (length), and is not a fragment of th same page */\n        if (curSplit.every((part, i) => splitRoute[i] === part) && splitRoute.length !== curSplit.length + 1) {\n          setTimeout(() => this.replaceContent(), 10); // a small delay, so we are sure the angular parts in the page are settled enough\n        }\n      };\n    }\n  }\n\n  private replaceContent(): void {\n    /**\n     * as Angular doesn't destroy the component if we stay on the same page,\n     * we have to manually delete old content. Also we need to kick of loading\n     * the new content. handlePage() takes care of that.\n     */\n    /** delete the content, as it is now out of date! */\n\n    window.scullyContent = undefined;\n    const parent = this.elm.parentElement;\n    let cur = findComments(parent, 'scullyContent-begin')[0] as ChildNode;\n    while (cur && cur !== this.elm) {\n      const next = cur.nextSibling;\n      parent.removeChild(cur);\n      cur = next;\n    }\n    this.handlePage();\n  }\n\n  getCSSId(elm: HTMLElement) {\n    return elm.getAttributeNames().find((a) => a.startsWith('_ngcontent')) || '';\n  }\n\n  ngOnDestroy() {\n    this.routeSub.unsubscribe();\n    /** reset the lastused */\n    lastHandled = '//';\n  }\n}\n","/**\n * Returns an array of nodes coninting all the html comments in the element.\n * When a searchText is given this is narrowed down to only comments that contian this text\n * @param rootElem Element to search nto\n * @param searchText optional string that needs to be in a HTML comment\n */\nexport function findComments(rootElem: HTMLElement, searchText?: string) {\n  const comments = [];\n  // Fourth argument, which is actually obsolete according to the DOM4 standard, seems required in IE 11\n  const iterator = document.createNodeIterator(\n    rootElem,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: node => {\n        // Logic to determine whether to accept, reject or skip node\n        // In this case, only accept nodes that have content\n        // that is containing our searchText, by rejecting any other nodes.\n        if (\n          searchText &&\n          node.nodeValue &&\n          !node.nodeValue.includes(searchText)\n        ) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        return NodeFilter.FILTER_ACCEPT;\n      }\n    }\n    // , false // IE-11 support requires this parameter.\n  );\n  let curNode;\n  // tslint:disable-next-line: no-conditional-assignment\n  while ((curNode = iterator.nextNode())) {\n    comments.push(curNode);\n  }\n  return comments;\n}\n","import { NgModule } from '@angular/core';\nimport { ScullyContentComponent } from './scully-content.component';\n\n@NgModule({\n  declarations: [ScullyContentComponent],\n  exports: [ScullyContentComponent]\n})\nexport class ScullyContentModule {}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { ScullyDefaultSettings, ScullyLibConfig, SCULLY_LIB_CONFIG } from './config/scully-config';\nimport { IdleMonitorService } from './idleMonitor/idle-monitor.service';\nimport { ScullyContentModule } from './scully-content/scully-content.module';\n\n@NgModule({\n  imports: [ScullyContentModule],\n  exports: [ScullyContentModule],\n})\nexport class ScullyLibModule {\n  /**\n   * We use a little trick to get a working idle-service.\n   * First, we separate out the component in a separate module to prevent a circulair injection\n   * second we create a constuctor that activates the IdleMonitorService. as that is provided for 'root'\n   * there will be only 1 instance in our app.\n   * We don't need forRoot, as we are not configuring anything in here.\n   */\n  static forRoot(config: ScullyLibConfig = ScullyDefaultSettings): ModuleWithProviders<any> {\n    config = Object.assign({}, ScullyDefaultSettings, config);\n    return {\n      ngModule: ScullyLibModule,\n      providers: [{ provide: SCULLY_LIB_CONFIG, useValue: config }],\n    };\n  }\n  constructor(private idle: IdleMonitorService) {}\n}\n"]}