{"version":3,"file":"scullyio-ng-lib.js","sources":["../../../../libs/ng-lib/src/lib/config/scully-config.ts","../../../../libs/ng-lib/src/lib/utils/basePathOnly.ts","../../../../libs/ng-lib/src/lib/utils/fetchHttp.ts","../../../../libs/ng-lib/src/lib/utils/isScully.ts","../../../../libs/ng-lib/src/lib/utils/merge-paths.ts","../../../../libs/ng-lib/src/lib/transfer-state/transfer-state.service.ts","../../../../libs/ng-lib/src/lib/idleMonitor/idle-monitor.service.ts","../../../../libs/ng-lib/src/lib/route-service/scully-routes.service.ts","../../../../libs/ng-lib/src/lib/utils/findComments.ts","../../../../libs/ng-lib/src/lib/scully-content/scully-content.component.ts","../../../../libs/ng-lib/src/lib/scully-content/scully-content.module.ts","../../../../libs/ng-lib/src/lib/scully-lib.module.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\nexport interface ScullyLibConfig {\n  useTransferState?: boolean;\n  alwaysMonitor?: boolean;\n  manualIdle?: boolean;\n  baseURIForScullyContent?: string;\n}\n\nexport const ScullyDefaultSettings: Required<ScullyLibConfig> = {\n  useTransferState: true,\n  alwaysMonitor: false,\n  manualIdle: false,\n  baseURIForScullyContent: 'http://localhost:1668',\n};\n\nexport const SCULLY_LIB_CONFIG = new InjectionToken<ScullyLibConfig>('scullyLibConfig', {\n  factory: () => ScullyDefaultSettings,\n});\n","/**\n * Take a string, preferably resembling an URL, take out the search params, the anchors, and the ending slash\n * @param str\n */\nexport const basePathOnly = (str: string): string => {\n  if (str.includes('#')) {\n    str = str.split('#')[0];\n  }\n  if (str.includes('?')) {\n    str = str.split('?')[0];\n  }\n  const cleanedUpVersion = str.endsWith('/') ? str.slice(0, -1) : str;\n  return cleanedUpVersion;\n};\n","export function fetchHttp<T>(\n  url: string,\n  responseType: XMLHttpRequestResponseType = 'json'\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    xhr.responseType = responseType;\n    xhr.addEventListener('load', ev => {\n      if (xhr.status !== 200) {\n        return reject(xhr);\n      }\n      resolve(xhr.response);\n    });\n    xhr.addEventListener('error', (...err) => reject(err));\n    xhr.open('get', url, true);\n    xhr.send();\n  });\n}\n","// tslint:disable: no-string-literal\nexport const isScullyRunning = () => window && window['ScullyIO'] === 'running';\nexport const isScullyGenerated = () =>\n  window && window['ScullyIO'] === 'generated';\n","export function mergePaths(base: string, path: string): string {\n  if (base.endsWith('/') && path.startsWith('/')) {\n    return `${base}${path.substr(1)}`;\n  }\n  if (!base.endsWith('/') && !path.startsWith('/')) {\n    return `${base}/${path}`;\n  }\n  return `${base}${path}`;\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { NavigationEnd, NavigationStart, Router } from '@angular/router';\nimport { BehaviorSubject, NEVER, Observable, of } from 'rxjs';\nimport { catchError, filter, first, map, pluck, shareReplay, switchMap, take, takeWhile, tap } from 'rxjs/operators';\nimport { basePathOnly } from '../utils/basePathOnly';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { isScullyGenerated, isScullyRunning } from '../utils/isScully';\nimport { mergePaths } from '../utils/merge-paths';\n\nconst SCULLY_SCRIPT_ID = `ScullyIO-transfer-state`;\nconst SCULLY_STATE_START = `/** ___SCULLY_STATE_START___ */`;\nconst SCULLY_STATE_END = `/** ___SCULLY_STATE_END___ */`;\nconst initialStateDone = '__done__with__Initial__navigation__';\n\ndeclare global {\n  interface Window {\n    'ScullyIO-injected': {\n      inlineStateOnly?: boolean;\n      [key: string]: any;\n    };\n  }\n}\n\ninterface State {\n  [key: string]: any;\n}\n// Adding this dynamic comment to suppress ngc error around Document as a DI token.\n// https://github.com/angular/angular/issues/20351#issuecomment-344009887\n/** @dynamic */\n@Injectable({\n  providedIn: 'root',\n})\nexport class TransferStateService {\n  private script: HTMLScriptElement;\n  /** parse from index, or load from data.json, according to scullConfig setting */\n  private inlineOnly = false;\n\n  private initialUrl: string;\n  /** set the currentBase to something that it can never be */\n  private currentBaseUrl = '//';\n  /** subject to fire off incoming states */\n  private stateBS = new BehaviorSubject<State>({});\n  private state$ = this.stateBS.pipe(filter((state) => state !== undefined));\n  // emit the next url when routing is complete\n  private nextUrl = this.router.events.pipe(\n    filter((e) => e instanceof NavigationStart),\n    switchMap((e: NavigationStart) => {\n      if (basePathOnly(this.initialUrl) === basePathOnly(e.url)) {\n        /** don't kick off on initial load to prevent flicker */\n        this.initialUrl = initialStateDone;\n        return NEVER;\n      }\n      return of(e);\n    }),\n    /** reset the state, so new components will never get stale data */\n    tap(() => this.stateBS.next(undefined)),\n    /** prevent emitting before navigation to _this_ URL is done. */\n    switchMap((e: NavigationStart) =>\n      this.router.events.pipe(\n        filter((ev) => ev instanceof NavigationEnd && ev.url === e.url),\n        first()\n      )\n    ),\n    map((ev: NavigationEnd) => basePathOnly(ev.urlAfterRedirects || ev.url)),\n    shareReplay(1)\n  );\n\n  constructor(@Inject(DOCUMENT) private document: Document, private router: Router) {}\n\n  startMonitoring() {\n    if (window && window['ScullyIO-injected'] && window['ScullyIO-injected'].inlineStateOnly) {\n      this.inlineOnly = true;\n    }\n    this.setupEnvForTransferState();\n    this.setupStartNavMonitoring();\n  }\n\n  private setupEnvForTransferState(): void {\n    if (isScullyRunning()) {\n      this.injectScript();\n      // In Scully puppeteer\n      const exposed = window['ScullyIO-exposed'] || {};\n      if (exposed.transferState) {\n        this.stateBS.next(exposed.transferState);\n        this.saveState(exposed.transferState);\n      }\n    } else if (isScullyGenerated()) {\n      // On the client AFTER scully rendered it\n      this.initialUrl = window.location.pathname || '__no_NO_no__';\n      this.initialUrl = this.initialUrl !== '/' && this.initialUrl.endsWith('/') ? this.initialUrl.slice(0, -1) : this.initialUrl;\n      /** set the initial state */\n      this.stateBS.next((window && window[SCULLY_SCRIPT_ID]) || {});\n    }\n  }\n\n  private injectScript() {\n    this.script = this.document.createElement('script');\n    this.script.setAttribute('id', SCULLY_SCRIPT_ID);\n    let last = document.body.lastChild;\n    while (last.previousSibling.nodeName === 'SCRIPT') {\n      last = last.previousSibling as ChildNode;\n    }\n    document.body.insertBefore(this.script, last);\n  }\n\n  /**\n   * Getstate will return an observable that containes the data.\n   * It does so right after the navigation for the page has finished.\n   * please note, this works SYNC on initial route, preventing a flash of content.\n   * @param name The name of the state to\n   */\n  getState<T>(name: string): Observable<T> {\n    /** start of the fetch for the current active route. */\n    this.fetchTransferState();\n    return this.state$.pipe(\n      pluck(name)\n      // tap((data) => console.log('tss', data))\n    );\n  }\n\n  /**\n   * Read the current state, and see if it has an value for the name.\n   * (note the value it containes still can be undefined!)\n   */\n  stateHasKey(name: string) {\n    return this.stateBS.value && this.stateBS.value.hasOwnProperty(name);\n  }\n\n  /**\n   * Read the current state, and see if it has an value for the name.\n   * ys also if there is actually an value in the state.\n   */\n  stateKeyHasValue(name: string) {\n    return this.stateBS.value && this.stateBS.value.hasOwnProperty(name) && this.stateBS.value[name] != null;\n  }\n\n  /**\n   * SetState will update the script in the generated page with data added.\n   * @param name\n   * @param val\n   */\n  setState<T>(name: string, val: T): void {\n    const newState = { ...this.stateBS.value, [name]: val };\n    this.stateBS.next(newState);\n    this.saveState(newState);\n  }\n\n  private saveState(newState) {\n    if (isScullyRunning()) {\n      this.script.textContent = `{window['${SCULLY_SCRIPT_ID}']=_u(\\`${SCULLY_STATE_START}${escapeHtml(\n        JSON.stringify(newState)\n      )}${SCULLY_STATE_END}\\`);function _u(t){t=t.split('${SCULLY_STATE_START}')[1].split('${SCULLY_STATE_END}')[0];const u={'_~b~': \"${'`'}\",'_~q~': \"'\",'_~o~': '$','_~s~': '/','_~l~': '<','_~g~': '>'};return JSON.parse(t.replace(/_~d~/g,'\\\\\\\\\"').replace(/_~[^]~/g, (s) => u[s]).replace(/\\\\n/g,'\\\\\\\\n').replace(/\\\\t/g,'\\\\\\\\t').replace(/\\\\r/g,'\\\\\\\\r'));}}`;\n    }\n  }\n\n  /**\n   * starts monitoring the router, and keep the url from the last completed navigation handy.\n   */\n  private setupStartNavMonitoring() {\n    if (!isScullyGenerated()) {\n      return;\n    }\n\n    /** start monitoring the routes */\n    this.nextUrl.subscribe();\n  }\n\n  /**\n   * Wraps an observable into scully's transfer state. If data for the provided `name` is\n   * available in the state, it gets returned. Otherwise, the `originalState` observable will\n   * be returned.\n   *\n   * On subsequent calls, the data in the state will always be returned. The `originalState` will\n   * be returned only once.\n   *\n   * This is a convenience method which does not require you to use `getState`/`setState` manually.\n   *\n   * @param name state key\n   * @param originalState an observable which yields the desired data\n   */\n  useScullyTransferState<T>(name: string, originalState: Observable<T>): Observable<T> {\n    if (isScullyGenerated()) {\n      return this.getState(name);\n    }\n    return originalState.pipe(tap((state) => this.setState(name, state)));\n  }\n\n  private async fetchTransferState(): Promise<void> {\n    /** helper to read the part before the first slash (ignores leading slash) */\n    const base = (url: string) => url.split('/').filter((part) => part.trim() !== '')[0];\n    /** put this in the next event cycle so the correct route can be read */\n    await new Promise((r) => setTimeout(r, 0));\n    /** get the current url */\n    const currentUrl = await this.nextUrl.pipe(take(1)).toPromise();\n    const baseUrl = base(currentUrl);\n    if (this.currentBaseUrl === baseUrl) {\n      /** already monitoring, don't tho a thing */\n      return;\n    }\n    /** keep the baseUrl for later reference */\n    this.currentBaseUrl = baseUrl;\n    this.nextUrl\n      .pipe(\n        /** keep updating till we move to another route */\n        takeWhile((url) => base(url) === this.currentBaseUrl),\n        // Get the next route's data from the the index or data file\n        switchMap((url) => (this.inlineOnly ? this.readFromIndex(url) : this.readFromJson(url))),\n        catchError((e) => {\n          // TODO: come up with better error text.\n          /** the developer needs to know, but its not fatal, so just return an empty state */\n          console.warn('Error while loading of parsing Scully state:', e);\n          return of({});\n        }),\n        tap((newState) => {\n          /** and activate the state in the components. on any error it will be empty */\n          this.stateBS.next(newState);\n        })\n      )\n      .subscribe({\n        /** when completes (different URL) */\n        complete: () => {\n          /** reset the currentBaseUrl */\n          this.currentBaseUrl = '//';\n        },\n      });\n  }\n\n  private readFromJson(url: string): Promise<object> {\n    return fetchHttp<object>(dropPreSlash(mergePaths(url, '/data.json')));\n  }\n\n  private readFromIndex(url): Promise<object> {\n    return fetchHttp<string>(dropPreSlash(mergePaths(url, '/index.html')), 'text').then((html: string) => {\n      const newStateStr = html.split(SCULLY_STATE_START)[1].split(SCULLY_STATE_END)[0];\n      return JSON.parse(unescapeHtml(newStateStr));\n    });\n  }\n}\n\nfunction dropPreSlash(string: string): string {\n  return string.startsWith('/') ? string.slice(1) : string;\n}\n\n/**\n * we need to escape our HTML to prevent XXS,\n * It needs to be custom, because the content can already contain html-escaped sequences\n **/\nexport function escapeHtml(text: string): string {\n  const escapedText: { [k: string]: string } = {\n    \"'\": '_~q~',\n    $: '_~o~',\n    '`': '_~b~',\n    '/': '_~s~',\n    '<': '_~l~',\n    '>': '_~g~',\n  };\n  return (\n    text\n      /** escape the json */\n      .replace(/[\\$`'<>\\/]/g, (s) => escapedText[s])\n      /** replace escaped double-quotes with single */\n      .replace(/\\\\\\\"/g, `_~d~`)\n  );\n}\n\n/**\n * Unescape our custom escaped texts\n * @param text\n */\nexport function unescapeHtml(text: string): string {\n  const unescapedText: { [k: string]: string } = {\n    '_~q~': \"'\",\n    '_~b~': '`',\n    '_~o~': '$',\n    '_~s~': '/',\n    '_~l~': '<',\n    '_~g~': '>',\n  };\n\n  return (\n    text\n      /** put back escaped double quotes to make valid json again */\n      .replace(/_~d~/g, `\\\\\"`)\n      /** replace the custom escapes */\n      .replace(/_~[^]~/g, (s) => unescapedText[s])\n      /** restore newlines+cr */\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n  );\n}\n","import { Inject, Injectable, NgZone } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { BehaviorSubject } from 'rxjs';\nimport { filter, pluck, take, tap } from 'rxjs/operators';\nimport { ScullyLibConfig, SCULLY_LIB_CONFIG, ScullyDefaultSettings } from '../config/scully-config';\nimport { TransferStateService } from '../transfer-state/transfer-state.service';\nimport { isScullyRunning } from '../utils/isScully';\n\n// tslint:disable-next-line: no-any\n// tslint:disable: no-string-literal\ndeclare const Zone: any;\n\ninterface LocalState {\n  idle: boolean;\n  timeOut: number;\n}\n\ndeclare global {\n  interface Window {\n    'ScullyIO-exposed': {\n      manualIdle?: boolean;\n      transferState?: any;\n      [key: string]: any;\n    };\n  }\n}\n\n// if (window) {\n//   window.addEventListener('AngularReady', ev => {\n//     console.log('appReady fired', ev);\n//   });\n// }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class IdleMonitorService {\n  private scullyLibConfig: ScullyLibConfig;\n  /** store the 'landing' url so we can skip it in idle-check. */\n  private initialUrl = dropEndingSlash(window && window.location && window.location.pathname) || '';\n  private imState = new BehaviorSubject<LocalState>({\n    idle: false,\n    timeOut: 5 * 1000, // 5 seconds timeout as default\n  });\n  public idle$ = this.imState.pipe(pluck('idle'));\n\n  private initApp = new Event('AngularInitialized', {\n    bubbles: true,\n    cancelable: false,\n  });\n  private appReady = new Event('AngularReady', {\n    bubbles: true,\n    cancelable: false,\n  });\n  private appTimeout = new Event('AngularTimeout', {\n    bubbles: true,\n    cancelable: false,\n  });\n\n  constructor(\n    private zone: NgZone,\n    private router: Router,\n    @Inject(SCULLY_LIB_CONFIG) conf: ScullyLibConfig,\n    tss: TransferStateService\n  ) {\n    /** provide the default for missing conf paramter */\n    this.scullyLibConfig = Object.assign({}, ScullyDefaultSettings, conf);\n    const exposed = window['ScullyIO-exposed'] || {};\n    const manualIdle = !!exposed.manualIdle;\n\n    if (!this.scullyLibConfig.manualIdle && window && (this.scullyLibConfig.alwaysMonitor || isScullyRunning())) {\n      window.dispatchEvent(this.initApp);\n      this.router.events\n        .pipe(\n          filter((ev) => ev instanceof NavigationEnd && ev.urlAfterRedirects !== undefined),\n          /** don't check the page that has this setting. event is only importand on page load */\n          filter((ev: NavigationEnd) => (manualIdle ? ev.urlAfterRedirects !== this.initialUrl : true)),\n          tap(() => this.zoneIdleCheck())\n        )\n        .subscribe();\n    }\n    if (this.scullyLibConfig.manualIdle) {\n      /** we still need the init event. */\n      window.dispatchEvent(this.initApp);\n    }\n    if (this.scullyLibConfig.useTransferState) {\n      /** don't start monitoring if people don't use the transferState */\n      tss.startMonitoring();\n    }\n  }\n\n  public async fireManualMyAppReadyEvent() {\n    return window.dispatchEvent(this.appReady);\n  }\n\n  public async init() {\n    return this.idle$.pipe(take(1)).toPromise();\n  }\n\n  private async zoneIdleCheck() {\n    if (Zone === undefined) {\n      return this.simpleTimeout();\n    }\n    const taskTrackingZone = Zone.current.get('TaskTrackingZone');\n    if (taskTrackingZone === undefined) {\n      return this.simpleTimeout();\n    }\n    if (this.imState.value.idle) {\n      await this.setState('idle', false);\n    }\n    /** run the actual check for 'idle' outsides zone, otherwise it will never come to an end. */\n    this.zone.runOutsideAngular(() => {\n      let tCancel: NodeJS.Timeout;\n      let count = 0;\n      const startTime = Date.now();\n      const monitor = () => {\n        clearTimeout(tCancel);\n        // console.table(taskTrackingZone.macroTasks);\n        if (Date.now() - startTime > 30 * 1000) {\n          /** bail out after 30 seconds. */\n          window.dispatchEvent(this.appTimeout);\n          return;\n        }\n        if (\n          (taskTrackingZone.macroTasks.length > 0 &&\n            taskTrackingZone.macroTasks.find((z: { source: string | string[] }) => z.source.includes('XMLHttpRequest')) !==\n              undefined) ||\n          count < 1 // make sure it runs at least once!\n        ) {\n          tCancel = setTimeout(() => {\n            count += 1;\n            monitor();\n          }, 50);\n          return;\n        }\n        this.zone.run(() => {\n          /** run this inside the zone, and give the app 250Ms to wrap up, before scraping starts */\n          setTimeout(() => {\n            window.dispatchEvent(this.appReady);\n            this.setState('idle', true);\n          }, 250);\n        });\n      };\n      monitor();\n    });\n  }\n\n  private async simpleTimeout() {\n    /** zone not available, use a timeout instead. */\n    console.warn('Scully is using timeouts, add the needed polyfills instead!');\n    await new Promise((r) => setTimeout(r, this.imState.value.timeOut));\n    window.dispatchEvent(this.appReady);\n  }\n\n  public setPupeteerTimeoutValue(milliseconds: number) {\n    this.imState.next({ ...this.imState.value, timeOut: milliseconds });\n  }\n\n  private setState(key: string, value: any) {\n    this.imState.next({ ...this.imState.value, [key]: value });\n  }\n}\n\nexport function dropEndingSlash(str: string) {\n  return str.endsWith('/') ? str.slice(0, -1) : str;\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, ReplaySubject, merge } from 'rxjs';\nimport {\n  catchError,\n  map,\n  shareReplay,\n  switchMap,\n  filter,\n} from 'rxjs/operators';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { Router, NavigationEnd, NavigationStart } from '@angular/router';\nimport { basePathOnly } from '../utils/basePathOnly';\n\nexport interface ScullyRoute {\n  route: string;\n  title?: string;\n  slugs?: string[];\n  published?: boolean;\n  slug?: string;\n  sourceFile?: string;\n  lang?: string;\n  [prop: string]: any;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ScullyRoutesService {\n  private refresh = new ReplaySubject<void>(1);\n  /**\n   * An observable with all routes, published and unpublished alike\n   */\n  allRoutes$: Observable<ScullyRoute[]> = this.refresh.pipe(\n    switchMap(() => fetchHttp<ScullyRoute[]>('assets/scully-routes.json')),\n    catchError(() => {\n      console.warn(\n        'Scully routes file not found, are you running the Scully generated version of your site?'\n      );\n      return of([] as ScullyRoute[]);\n    }),\n    /** filter out all non-array results */\n    filter((routes) => Array.isArray(routes)),\n    map(this.cleanDups),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n  /**\n   * An observable with available routes (all published routes)\n   */\n  available$ = this.allRoutes$.pipe(\n    map((list) =>\n      list.filter((r) =>\n        r.hasOwnProperty('published') ? r.published !== false : true\n      )\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  /**\n   * an observable with all unpublished routes\n   */\n  unPublished$ = this.allRoutes$.pipe(\n    map((list) =>\n      list.filter((r) =>\n        r.hasOwnProperty('published') ? r.published === false : false\n      )\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  /**\n   * An observable with the top-level off all published routes.\n   * (in an urls it would be `http://www.sample.org/__thisPart__/subroutes`)\n   */\n  topLevel$: Observable<ScullyRoute[]> = this.available$.pipe(\n    map((routes) =>\n      routes.filter((r: ScullyRoute) => !r.route.slice(1).includes('/'))\n    ),\n    shareReplay({ refCount: false, bufferSize: 1 })\n  );\n\n  constructor(private router: Router) {\n    /** kick off first cycle */\n    this.reload();\n  }\n\n  /**\n   * returns an observable that returns the route information for the\n   * route currently selected. subscribes to route-events to update when needed\n   */\n  getCurrent(): Observable<ScullyRoute> {\n    if (!location) {\n      /** probably not in a browser, no current location available */\n      return of();\n    }\n    /** fire off at start, and when navigation is done. */\n    return merge(of(new NavigationEnd(0, '', '')), this.router.events).pipe(\n      filter((e) => e instanceof NavigationEnd),\n      switchMap(() => this.available$),\n      map((list) => {\n        const curLocation = basePathOnly(encodeURI(location.pathname).trim());\n        return list.find(\n          (r) =>\n            curLocation === basePathOnly(r.route.trim()) ||\n            (r.slugs &&\n              Array.isArray(r.slugs) &&\n              r.slugs.find((slug) =>\n                curLocation.endsWith(basePathOnly(slug.trim()))\n              ))\n        );\n      })\n    );\n  }\n\n  /**\n   * internal, as routes can have multiple slugs, and so occur multiple times\n   * this util function collapses all slugs back into 1 route.\n   */\n  private cleanDups(routes: ScullyRoute[]) {\n    const m = new Map<string, ScullyRoute>();\n    /** check for duplicates by comparing all, include route in comparison if its the only thing, or the only thing with only the tile  */\n    routes.forEach((r) =>\n      m.set(JSON.stringify({ ...r, route: hasOtherprops(r) ? '' : r.route }), r)\n    );\n    return [...m.values()];\n  }\n\n  /** an utility that will force a reload of the `scully-routes.json` file */\n  reload(): void {\n    this.refresh.next();\n  }\n}\n\nfunction hasOtherprops(obj) {\n  const keys = Object.keys(obj);\n  if (keys.length === 1 && keys.includes('route')) {\n    return false;\n  }\n  if (keys.length === 2 && keys.includes('route') && keys.includes('title')) {\n    return false;\n  }\n  return true;\n}\n","/**\n * Returns an array of nodes coninting all the html comments in the element.\n * When a searchText is given this is narrowed down to only comments that contian this text\n * @param rootElem Element to search nto\n * @param searchText optional string that needs to be in a HTML comment\n */\nexport function findComments(rootElem: HTMLElement, searchText?: string) {\n  const comments = [];\n  // Fourth argument, which is actually obsolete according to the DOM4 standard, seems required in IE 11\n  const iterator = document.createNodeIterator(\n    rootElem,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: node => {\n        // Logic to determine whether to accept, reject or skip node\n        // In this case, only accept nodes that have content\n        // that is containing our searchText, by rejecting any other nodes.\n        if (\n          searchText &&\n          node.nodeValue &&\n          !node.nodeValue.includes(searchText)\n        ) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        return NodeFilter.FILTER_ACCEPT;\n      }\n    }\n    // , false // IE-11 support requires this parameter.\n  );\n  let curNode;\n  // tslint:disable-next-line: no-conditional-assignment\n  while ((curNode = iterator.nextNode())) {\n    comments.push(curNode);\n  }\n  return comments;\n}\n","import { Location } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Inject,\n  isDevMode,\n  OnDestroy,\n  OnInit,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { filter, take, tap } from 'rxjs/operators';\nimport { ScullyDefaultSettings, ScullyLibConfig, SCULLY_LIB_CONFIG } from '../config/scully-config';\nimport { ScullyRoutesService } from '../route-service/scully-routes.service';\nimport { basePathOnly } from '../utils/basePathOnly';\nimport { fetchHttp } from '../utils/fetchHttp';\nimport { findComments } from '../utils/findComments';\n\ninterface ScullyContent {\n  html: string;\n  cssId: string;\n}\ndeclare global {\n  interface Window {\n    scullyContent: ScullyContent;\n  }\n}\n/** this is needed, because otherwise the CLI borks while building */\nconst scullyBegin = '<!--scullyContent-begin-->';\nconst scullyEnd = '<!--scullyContent-end-->';\n\n/** use the module's closure to keep a system-wide check for the last handled URL. */\nlet lastHandled: String;\n\n@Component({\n  // tslint:disable-next-line: component-selector\n  selector: 'scully-content',\n  template: '<ng-content></ng-content>',\n  styles: [\n    `\n      :host {\n        display: none;\n      }\n      scully-content {\n        display: none;\n      }\n    `,\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n  preserveWhitespaces: true,\n})\nexport class ScullyContentComponent implements OnDestroy, OnInit {\n  baseUrl = this.conf.useTransferState || ScullyDefaultSettings.useTransferState;\n  elm = this.elmRef.nativeElement as HTMLElement;\n  /** pull in all  available routes into an eager promise */\n  routes = this.srs.allRoutes$.pipe(take(1)).toPromise();\n  /** monitor the router, so we can update while navigating in the same 'page' see #311 */\n  routeUpdates$ = this.router.events.pipe(\n    filter((ev) => ev instanceof NavigationEnd),\n    /** don't replace if we are already there */\n    filter((ev: NavigationEnd) => lastHandled && !lastHandled.endsWith(ev.urlAfterRedirects)),\n    tap((r) => this.replaceContent())\n  );\n\n  routeSub = this.routeUpdates$.subscribe();\n\n  constructor(\n    private elmRef: ElementRef,\n    private srs: ScullyRoutesService,\n    private router: Router,\n    private location: Location,\n    @Inject(SCULLY_LIB_CONFIG) private conf: ScullyLibConfig\n  ) {\n    /** do this from constructor, so it runs ASAP */\n  }\n\n  ngOnInit(): void {\n    if (this.elm) {\n      /** this will only fire in a browser environment */\n      this.handlePage();\n    }\n  }\n\n  /**\n   * Loads the static content from scully into the view\n   * Will fetch the content from sibling links with xmlHTTPrequest\n   */\n  private async handlePage() {\n    const curPage = basePathOnly(location.href);\n    if (lastHandled === curPage) {\n      /**\n       * Due to the fix we needed for #311\n       * it might happen that this routine is called\n       * twice for the same page.\n       * this code will make sure the second one is ignored.\n       */\n      return;\n    }\n    lastHandled = curPage;\n    const template = document.createElement('template');\n    const currentCssId = this.getCSSId(this.elm);\n    if (window.scullyContent) {\n      /** upgrade existing static content */\n      const htmlString = window.scullyContent.html;\n      if (currentCssId !== window.scullyContent.cssId) {\n        /** replace the angular cssId */\n        template.innerHTML = htmlString.split(window.scullyContent.cssId).join(currentCssId);\n      } else {\n        template.innerHTML = htmlString;\n      }\n    } else {\n      /**\n       *   NOTE\n       * when updateting the texts for the errors, make sure you leave the\n       *  `id=\"___scully-parsing-error___\"`\n       * in there. That way users can detect rendering errors in their CI\n       * on a reliable way.\n       */\n      await fetchHttp(curPage + '/index.html', 'text')\n        .catch((e) => {\n          if (isDevMode()) {\n            /** in devmode (usually in `ng serve`) check the scully server for the content too */\n            const uri = new URL(location.href);\n            const url = `${this.conf.baseURIForScullyContent}/${basePathOnly(uri.pathname)}/index.html`;\n            return fetchHttp(url, 'text');\n          } else {\n            return Promise.reject(e);\n          }\n        })\n        .then((html: string) => {\n          try {\n            const htmlString = html.split(scullyBegin)[1].split(scullyEnd)[0];\n            if (htmlString.includes('_ngcontent')) {\n              /** update the angular cssId */\n              const atr = '_ngcontent' + htmlString.split('_ngcontent')[1].split('=')[0];\n              template.innerHTML = htmlString.split(atr).join(currentCssId);\n            } else {\n              template.innerHTML = htmlString;\n            }\n          } catch (e) {\n            template.innerHTML = `<h2 id=\"___scully-parsing-error___\">Sorry, could not parse static page content</h2>\n            <p>This might happen if you are not using the static generated pages.</p>`;\n          }\n        })\n        .catch((e) => {\n          template.innerHTML = '<h2 id=\"___scully-parsing-error___\">Sorry, could not load static page content</h2>';\n          console.error('problem during loading static scully content', e);\n        });\n    }\n    /** insert the whole thing just before the `<scully-content>` element */\n    const parent = this.elm.parentElement || document.body;\n    const begin = document.createComment('scullyContent-begin');\n    const end = document.createComment('scullyContent-end');\n    parent.insertBefore(begin, this.elm);\n    parent.insertBefore(template.content, this.elm);\n    parent.insertBefore(end, this.elm);\n    /** upgrade all hrefs to simulated routelinks (in next microtask) */\n    setTimeout(() => document.querySelectorAll('[href]').forEach(this.upgradeToRoutelink.bind(this)), 10);\n    // document.querySelectorAll('[href]').forEach(this.upgradeToRoutelink.bind(this));\n  }\n\n  /**\n   * upgrade a **href** attributes to links that respect the Angular router\n   * and don't do a full page reload. Only works on links that are found in the\n   * Scully route config file.\n   * @param elm the element containing the **hrefs**\n   */\n  async upgradeToRoutelink(elm: HTMLElement) {\n    if (!['A', 'BUTTON'].includes(elm.tagName)) {\n      return;\n    }\n    const hash = elm.dataset.hash;\n    if (hash) {\n      elm.setAttribute('href', '#' + hash);\n      elm.setAttribute('onclick', '');\n      elm.onclick = (ev: MouseEvent) => {\n        ev.preventDefault();\n        const destination = document.getElementById(hash);\n        if (destination) {\n          const url = new URL(window.location.href);\n          url.hash = hash;\n          history.replaceState('', '', url.toString());\n          destination.scrollIntoView();\n        }\n      };\n      return;\n    }\n    const routes = await this.routes;\n    const href = elm.getAttribute('href');\n    const lnk = basePathOnly(href.toLowerCase());\n    const route = routes.find((r) => basePathOnly(r.route.toLowerCase()) === lnk);\n\n    /** only upgrade routes known by scully. */\n    if (lnk && route && !lnk.startsWith('#')) {\n      elm.onclick = async (ev: MouseEvent) => {\n        const splitRoute = route.route.split(`/`);\n        const curSplit = location.pathname.split('/');\n        // loose last \"part\" of route\n        curSplit.pop();\n\n        ev.preventDefault();\n        const routed = await this.router.navigate(splitRoute).catch((e) => {\n          console.error('routing error', e);\n          return false;\n        });\n        if (!routed) {\n          return;\n        }\n\n        /** check for the same route with different \"data\", and NOT a 1 level higher (length), and is not a fragment of th same page */\n        if (curSplit.every((part, i) => splitRoute[i] === part) && splitRoute.length !== curSplit.length + 1) {\n          setTimeout(() => this.replaceContent(), 10); // a small delay, so we are sure the angular parts in the page are settled enough\n        }\n      };\n    }\n  }\n\n  private replaceContent(): void {\n    /**\n     * as Angular doesn't destroy the component if we stay on the same page,\n     * we have to manually delete old content. Also we need to kick of loading\n     * the new content. handlePage() takes care of that.\n     */\n    /** delete the content, as it is now out of date! */\n\n    window.scullyContent = undefined;\n    const parent = this.elm.parentElement;\n    let cur = findComments(parent, 'scullyContent-begin')[0] as ChildNode;\n    while (cur && cur !== this.elm) {\n      const next = cur.nextSibling;\n      parent.removeChild(cur);\n      cur = next;\n    }\n    this.handlePage();\n  }\n\n  getCSSId(elm: HTMLElement) {\n    return elm.getAttributeNames().find((a) => a.startsWith('_ngcontent')) || '';\n  }\n\n  ngOnDestroy() {\n    this.routeSub.unsubscribe();\n    /** reset the lastused */\n    lastHandled = '//';\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { ScullyContentComponent } from './scully-content.component';\n\n@NgModule({\n  declarations: [ScullyContentComponent],\n  exports: [ScullyContentComponent]\n})\nexport class ScullyContentModule {}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { ScullyDefaultSettings, ScullyLibConfig, SCULLY_LIB_CONFIG } from './config/scully-config';\nimport { IdleMonitorService } from './idleMonitor/idle-monitor.service';\nimport { ScullyContentModule } from './scully-content/scully-content.module';\n\n@NgModule({\n  imports: [ScullyContentModule],\n  exports: [ScullyContentModule],\n})\nexport class ScullyLibModule {\n  /**\n   * We use a little trick to get a working idle-service.\n   * First, we separate out the component in a separate module to prevent a circulair injection\n   * second we create a constuctor that activates the IdleMonitorService. as that is provided for 'root'\n   * there will be only 1 instance in our app.\n   * We don't need forRoot, as we are not configuring anything in here.\n   */\n  static forRoot(config: ScullyLibConfig = ScullyDefaultSettings): ModuleWithProviders<any> {\n    config = Object.assign({}, ScullyDefaultSettings, config);\n    return {\n      ngModule: ScullyLibModule,\n      providers: [{ provide: SCULLY_LIB_CONFIG, useValue: config }],\n    };\n  }\n  constructor(private idle: IdleMonitorService) {}\n}\n"],"names":[],"mappings":"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"}