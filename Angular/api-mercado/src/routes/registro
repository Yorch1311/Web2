const { Router } = require('express');
const router = Router();
const db = require("./index.js");

//enviar datos para crear nuevo usuario
router.post('/', async (req, res) => {

    const datoReq = req.body;
    await db.collection('usuarios').doc(datoReq.email).get()
    .then(doc => {
        if (doc.exists){
            const enviar = { 
                status: 400, 
                message: "El correo ya estaba registrado."
            };
            res.status(200).json(enviar);
        }else{
            const user = db.collection('usuarios').doc(datoReq.email);
            const datos = { ...datoReq, rol: "cliente"}; 
        
            console.log(datos);
            user.set(datos);
            const enviar = { 
                status: 200, 
                message: "Usuario registrado con exito."
            };
            res.status(200).json(enviar);
        }
    });

    res.end();
});

module.exports = router;